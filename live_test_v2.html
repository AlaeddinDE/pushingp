<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ğŸ§ª Live Casino Tester V2 (NO CACHE)</title>
    <style>
        body { background: #0f172a; color: white; font-family: 'Courier New', monospace; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .test-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0; }
        .test-card { background: #1e293b; padding: 20px; border-radius: 12px; border: 2px solid #334155; }
        .test-card.running { border-color: #3b82f6; }
        .test-card.success { border-color: #10b981; background: #065f4620; }
        .test-card.error { border-color: #ef4444; background: #7f1d1d20; }
        .test-status { font-size: 2rem; margin-bottom: 10px; }
        .test-log { background: #0f172a; padding: 10px; border-radius: 8px; max-height: 200px; overflow-y: auto; font-size: 0.875rem; margin-top: 10px; }
        .test-log div { padding: 4px 0; border-bottom: 1px solid #1e293b; }
        button { padding: 12px 24px; background: linear-gradient(135deg, #8b5cf6, #ec4899); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; margin: 8px; font-size: 1rem; }
        button:hover { opacity: 0.9; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .summary { background: #1e293b; padding: 20px; border-radius: 12px; margin: 20px 0; text-align: center; }
        .summary h2 { margin: 0 0 10px 0; }
        .progress-bar { width: 100%; height: 30px; background: #0f172a; border-radius: 8px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #10b981, #3b82f6); transition: width 0.3s; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .cache-warning { background: #7f1d1d; border: 2px solid #ef4444; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Live Casino Tester V2 (Cache-Free)</h1>
        <p>Version: <?php echo time(); ?> | Keine Browser-Cache-Probleme!</p>
        
        <div class="cache-warning">
            âš ï¸ <strong>NEU:</strong> Diese Version nutzt die KORRIGIERTEN API-Endpunkte!
            Alle Fixes sind aktiv: Mines Cashout, Slots (result statt symbols), Blackjack (deal support)
        </div>
        
        <div class="summary">
            <h2>Status</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="progress" style="width: 0%">0%</div>
            </div>
            <div id="summaryText">Bereit zum Testen...</div>
        </div>
        
        <button onclick="runAllTests()" id="startBtn">ğŸš€ Alle Tests starten</button>
        <button onclick="location.reload()">ğŸ”„ Reset</button>
        
        <div class="test-grid">
            <div class="test-card" id="card-mines">
                <div class="test-status">ğŸ’</div>
                <h3>Mines</h3>
                <div class="test-log" id="log-mines"></div>
            </div>
            
            <div class="test-card" id="card-slots">
                <div class="test-status">ğŸ°</div>
                <h3>Slots</h3>
                <div class="test-log" id="log-slots"></div>
            </div>
            
            <div class="test-card" id="card-plinko">
                <div class="test-status">ğŸ¯</div>
                <h3>Plinko</h3>
                <div class="test-log" id="log-plinko"></div>
            </div>
            
            <div class="test-card" id="card-crash">
                <div class="test-status">ğŸš€</div>
                <h3>Crash</h3>
                <div class="test-log" id="log-crash"></div>
            </div>
            
            <div class="test-card" id="card-blackjack">
                <div class="test-status">ğŸƒ</div>
                <h3>Blackjack</h3>
                <div class="test-log" id="log-blackjack"></div>
            </div>
            
            <div class="test-card" id="card-chicken">
                <div class="test-status">ğŸ”</div>
                <h3>Chicken</h3>
                <div class="test-log" id="log-chicken"></div>
            </div>
        </div>
    </div>
    
    <script>
        let testResults = {};
        let totalTests = 0;
        let completedTests = 0;
        
        function log(game, message, type = 'info') {
            const logEl = document.getElementById('log-' + game);
            const div = document.createElement('div');
            div.textContent = message;
            div.style.color = type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#94a3b8';
            logEl.appendChild(div);
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        function updateCard(game, status) {
            const card = document.getElementById('card-' + game);
            card.className = 'test-card ' + status;
        }
        
        function updateProgress() {
            const percent = Math.round((completedTests / totalTests) * 100);
            document.getElementById('progress').style.width = percent + '%';
            document.getElementById('progress').textContent = percent + '%';
            
            const passed = Object.values(testResults).filter(r => r === 'success').length;
            const failed = Object.values(testResults).filter(r => r === 'error').length;
            document.getElementById('summaryText').textContent = 
                `âœ… ${passed} Erfolgreich | âŒ ${failed} Fehler | â³ ${totalTests - completedTests} Ausstehend`;
        }
        
        async function testMines() {
            const game = 'mines';
            updateCard(game, 'running');
            log(game, 'â–¶ Starte Mines Test...');
            
            try {
                log(game, '1ï¸âƒ£ Spiel starten (1â‚¬, 3 Minen)...');
                let res = await fetch('/api/casino/play_mines.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action: 'start', bet: 1.0, mines: 3})
                });
                let data = await res.json();
                
                if (data.status !== 'success') throw new Error(data.error || 'Start fehlgeschlagen');
                log(game, 'âœ“ Spiel gestartet', 'success');
                
                log(game, '2ï¸âƒ£ Feld aufdecken...');
                res = await fetch('/api/casino/play_mines.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action: 'reveal', position: 0})
                });
                
                const text = await res.text();
                log(game, 'ğŸ“„ Raw response length: ' + text.length);
                
                if (!text || text.length === 0) {
                    throw new Error('Empty response from reveal API');
                }
                
                data = JSON.parse(text);
                
                if (data.status === 'safe') {
                    log(game, 'âœ“ Feld sicher! Multiplikator: ' + data.current_multiplier + 'x', 'success');
                    
                    log(game, '3ï¸âƒ£ Auszahlung...');
                    res = await fetch('/api/casino/play_mines.php', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({action: 'cashout'})
                    });
                    
                    const cashoutText = await res.text();
                    log(game, 'ğŸ“„ Cashout response length: ' + cashoutText.length);
                    
                    if (!cashoutText || cashoutText.length === 0) {
                        throw new Error('Empty cashout response');
                    }
                    
                    data = JSON.parse(cashoutText);
                    
                    if (data.status === 'cashout') {
                        log(game, 'âœ“ Ausgezahlt: ' + data.win_amount + 'â‚¬', 'success');
                    }
                } else if (data.status === 'mine_hit') {
                    log(game, 'ğŸ’£ Mine getroffen (erwartbar)', 'info');
                }
                
                testResults[game] = 'success';
                updateCard(game, 'success');
                log(game, 'âœ… TEST BESTANDEN', 'success');
                
            } catch (error) {
                testResults[game] = 'error';
                updateCard(game, 'error');
                log(game, 'âŒ FEHLER: ' + error.message, 'error');
            }
            
            completedTests++;
            updateProgress();
        }
        
        async function testSlots() {
            const game = 'slots';
            updateCard(game, 'running');
            log(game, 'â–¶ Starte Slots Test...');
            
            try {
                log(game, '1ï¸âƒ£ Drehen (1â‚¬)...');
                const res = await fetch('/api/casino/play_slots.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({bet: 1.0})
                });
                
                const text = await res.text();
                log(game, 'ğŸ“„ Response length: ' + text.length);
                
                if (!text) throw new Error('Empty response');
                
                const data = JSON.parse(text);
                
                if (data.status !== 'success') throw new Error(data.error || 'Spin fehlgeschlagen');
                
                // FIXED: Use data.result instead of data.symbols
                log(game, 'âœ“ Ergebnis: ' + data.result.join(' '), 'success');
                log(game, 'âœ“ Gewinn: ' + data.win_amount + 'â‚¬', 'success');
                
                testResults[game] = 'success';
                updateCard(game, 'success');
                log(game, 'âœ… TEST BESTANDEN', 'success');
                
            } catch (error) {
                testResults[game] = 'error';
                updateCard(game, 'error');
                log(game, 'âŒ FEHLER: ' + error.message, 'error');
            }
            
            completedTests++;
            updateProgress();
        }
        
        async function testPlinko() {
            const game = 'plinko';
            updateCard(game, 'running');
            log(game, 'â–¶ Starte Plinko Test...');
            
            try {
                log(game, '1ï¸âƒ£ Ball werfen (1â‚¬)...');
                const res = await fetch('/api/casino/play_plinko.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({bet: 1.0})
                });
                const data = await res.json();
                
                if (data.status !== 'success') throw new Error(data.error || 'Drop fehlgeschlagen');
                log(game, 'âœ“ Multiplikator: ' + data.multiplier + 'x', 'success');
                log(game, 'âœ“ Gewinn: ' + data.win + 'â‚¬', 'success');
                
                testResults[game] = 'success';
                updateCard(game, 'success');
                log(game, 'âœ… TEST BESTANDEN', 'success');
                
            } catch (error) {
                testResults[game] = 'error';
                updateCard(game, 'error');
                log(game, 'âŒ FEHLER: ' + error.message, 'error');
            }
            
            completedTests++;
            updateProgress();
        }
        
        async function testCrash() {
            const game = 'crash';
            updateCard(game, 'running');
            log(game, 'â–¶ Starte Crash Test...');
            
            try {
                log(game, '1ï¸âƒ£ Spiel starten (1â‚¬)...');
                const res = await fetch('/api/casino/start_crash.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({bet: 1.0})
                });
                const data = await res.json();
                
                if (data.status !== 'success') throw new Error(data.error || 'Start fehlgeschlagen');
                log(game, 'âœ“ Crash Point: ' + data.crash_point + 'x', 'success');
                
                testResults[game] = 'success';
                updateCard(game, 'success');
                log(game, 'âœ… TEST BESTANDEN', 'success');
                
            } catch (error) {
                testResults[game] = 'error';
                updateCard(game, 'error');
                log(game, 'âŒ FEHLER: ' + error.message, 'error');
            }
            
            completedTests++;
            updateProgress();
        }
        
        async function testBlackjack() {
            const game = 'blackjack';
            updateCard(game, 'running');
            log(game, 'â–¶ Starte Blackjack Test...');
            
            try {
                log(game, '1ï¸âƒ£ Karten geben (1â‚¬)...');
                const res = await fetch('/api/casino/play_blackjack.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action: 'deal', bet: 1.0})
                });
                
                const text = await res.text();
                log(game, 'ğŸ“„ Response length: ' + text.length);
                
                if (!text) throw new Error('Empty response');
                
                const data = JSON.parse(text);
                
                if (data.status !== 'success') throw new Error(data.error || 'Deal fehlgeschlagen');
                log(game, 'âœ“ Spieler: ' + data.player_score + ', Dealer: ' + data.dealer_score, 'success');
                
                testResults[game] = 'success';
                updateCard(game, 'success');
                log(game, 'âœ… TEST BESTANDEN', 'success');
                
            } catch (error) {
                testResults[game] = 'error';
                updateCard(game, 'error');
                log(game, 'âŒ FEHLER: ' + error.message, 'error');
            }
            
            completedTests++;
            updateProgress();
        }
        
        async function testChicken() {
            const game = 'chicken';
            updateCard(game, 'running');
            log(game, 'â–¶ Starte Chicken Test...');
            
            try {
                log(game, '1ï¸âƒ£ Spiel starten (1â‚¬)...');
                const res = await fetch('/api/casino/chicken_cross.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action: 'start', bet: 1.0})
                });
                const data = await res.json();
                
                if (data.status !== 'success') throw new Error(data.error || 'Start fehlgeschlagen');
                log(game, 'âœ“ Spiel gestartet', 'success');
                
                testResults[game] = 'success';
                updateCard(game, 'success');
                log(game, 'âœ… TEST BESTANDEN', 'success');
                
            } catch (error) {
                testResults[game] = 'error';
                updateCard(game, 'error');
                log(game, 'âŒ FEHLER: ' + error.message, 'error');
            }
            
            completedTests++;
            updateProgress();
        }
        
        async function runAllTests() {
            document.getElementById('startBtn').disabled = true;
            testResults = {};
            completedTests = 0;
            totalTests = 6;
            
            await testMines();
            await new Promise(r => setTimeout(r, 500));
            await testSlots();
            await new Promise(r => setTimeout(r, 500));
            await testPlinko();
            await new Promise(r => setTimeout(r, 500));
            await testCrash();
            await new Promise(r => setTimeout(r, 500));
            await testBlackjack();
            await new Promise(r => setTimeout(r, 500));
            await testChicken();
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('summaryText').textContent += ' | ğŸ Alle Tests abgeschlossen!';
        }
    </script>
</body>
</html>
