<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Pushing P ‚Äî Crew, Kasse, Schichten und Live-Status. Alles in einem modernen Dashboard." />
  <link rel="icon" href="assets/img/favicon.png" />
  <title>Pushing P ‚Äî Crew Landing</title>

  <!-- Tailwind + GSAP (CDN for speed) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>

  <style>
    :root { color-scheme: dark; }
    html,body { height:100%; }
    body {
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans",sans-serif;
      color:#fff;
      background:#06060a;
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }
    body::before, body::after {
      content:"";
      position:fixed;
      width:120vmax;
      height:120vmax;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      z-index:-2;
      filter:blur(80px);
      opacity:0.55;
      background:radial-gradient(circle at center, rgba(96,165,250,0.35), rgba(56,189,248,0) 55%);
      pointer-events:none;
    }
    body::after{
      background:radial-gradient(circle at center, rgba(244,114,182,0.32), rgba(125,211,252,0) 60%);
      mix-blend-mode:screen;
      opacity:0.45;
    }

    .hero-neon{
      position:absolute;
      inset:-10% -20%;
      background:radial-gradient(circle at 20% 20%, rgba(59,130,246,0.3), transparent 60%),
                 radial-gradient(circle at 80% 30%, rgba(236,72,153,0.3), transparent 65%),
                 radial-gradient(circle at 50% 90%, rgba(56,189,248,0.28), transparent 60%);
      filter:blur(40px);
      opacity:0.7;
      z-index:0;
      transform:translateZ(0);
      transform-origin:center;
    }

    .hero-wires{
      position:absolute;
      inset:0;
      background-image:linear-gradient(120deg, rgba(255,255,255,0.04) 1px, transparent 1px),
                       linear-gradient(-120deg, rgba(255,255,255,0.04) 1px, transparent 1px);
      background-size:120px 120px;
      mask-image:radial-gradient(circle at center, rgba(0,0,0,0.85), transparent 70%);
      opacity:0.4;
      z-index:1;
      animation:gridFloat 18s linear infinite;
    }
    @keyframes gridFloat { to { background-position:200px 0, -200px 0; } }

    .hero-spark {
      position:absolute;
      top:50%;
      left:50%;
      width:260px;
      height:260px;
      margin:-130px 0 0 -130px;
      border-radius:50%;
      background:radial-gradient(circle, rgba(255,255,255,0.45), rgba(59,130,246,0) 60%);
      filter:blur(18px);
      opacity:0.65;
      z-index:2;
      mix-blend-mode:screen;
      animation:pulseSpark 6s ease-in-out infinite;
    }
    @keyframes pulseSpark { 0%,100%{transform:translate(-50%,-50%) scale(0.9);}50%{transform:translate(-50%,-50%) scale(1.05);} }

    /* Gradient text */
    .grad-text { 
      background:linear-gradient(135deg, #60a5fa 0%, #a78bfa 30%, #f472b6 60%, #22d3ee 90%);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      background-size:200% 200%;
      animation:gradientShift 8s linear infinite;
    }
    @keyframes gradientShift { 0%,100%{background-position:0% 50%}50%{background-position:100% 50%} }

    .glass{ background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.06); backdrop-filter:blur(8px);} 
    .glass-strong{
      background:linear-gradient(135deg, rgba(255,255,255,0.12), rgba(17,25,40,0.35));
      border:1px solid rgba(255,255,255,0.1);
      backdrop-filter:blur(14px) saturate(140%);
    }

    .aurora-line {
      position:absolute;
      inset:10% 12%;
      border-radius:40px;
      border:1px solid rgba(255,255,255,0.05);
      background:linear-gradient(120deg, rgba(99,102,241,0.14), rgba(236,72,153,0.08));
      mask-image:radial-gradient(circle at top, black 55%, transparent 90%);
      filter:blur(12px);
      opacity:0.4;
      z-index:1;
    }

    /* Interactions */
    .magnet{ transition:transform .24s cubic-bezier(.2,.9,.2,1)}.magnet:active{transform:translateY(1px)}
    .float{ animation:float 6s ease-in-out infinite } @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}

    .pulse-glow{ animation:pulseGlow 3s infinite } @keyframes pulseGlow{0%,100%{box-shadow:0 18px 40px rgba(99,102,241,0.18)}50%{box-shadow:0 30px 80px rgba(99,102,241,0.26)}}

    .stat-card{ transition:all .4s cubic-bezier(.2,.9,.2,1)} .stat-card:hover{ transform:translateY(-10px) scale(1.02); box-shadow:0 30px 90px rgba(0,0,0,0.5)}

    /* Small utility */
    .shadow-glow{ box-shadow: 0 20px 60px rgba(99,102,241,0.08) }

    .shift-grid { display:grid; gap:1.5rem; }
    @media(min-width:1024px){ .shift-grid{ grid-template-columns:repeat(3,minmax(0,1fr)); } }

    .shift-timeline {
      position:relative;
      padding:1.5rem;
      border-radius:1.5rem;
      background:linear-gradient(135deg, rgba(15,23,42,0.65), rgba(30,41,59,0.45));
      border:1px solid rgba(148,163,184,0.15);
      overflow:visible;
    }
    .shift-timeline-track{
      position:relative;
      height:110px;
      border-radius:20px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(148,163,184,0.2);
      overflow:visible;
    }
    .shift-block{
      position:absolute;
      top:18px;
      height:74px;
      border-radius:16px;
      padding:0.75rem 1rem;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:flex-start;
      gap:0.25rem;
      box-shadow:0 20px 45px rgba(59,130,246,0.25);
      background:linear-gradient(135deg, rgba(59,130,246,0.9), rgba(14,165,233,0.9));
      backdrop-filter:blur(6px);
      min-width:120px;
      cursor:pointer;
      overflow:visible;
      outline:none;
      transition:transform .25s ease, box-shadow .25s ease;
    }
    .shift-block[data-state="current"]{ background:linear-gradient(135deg, rgba(34,197,94,0.9), rgba(16,185,129,0.95)); box-shadow:0 25px 60px rgba(16,185,129,0.25); }
    .shift-block[data-state="upcoming"]{ background:linear-gradient(135deg, rgba(244,114,182,0.9), rgba(139,92,246,0.9)); box-shadow:0 25px 60px rgba(244,114,182,0.25); }
    .shift-block[data-extends="true"]{ box-shadow:0 25px 60px rgba(148,163,184,0.28); }
    .shift-block strong{ letter-spacing:0.01em; }
    .shift-block .shift-time{ font-size:0.72rem; color:rgba(255,255,255,0.78); }
    .shift-block .shift-overnight{
      display:inline-flex;
      align-items:center;
      gap:0.25rem;
      margin-top:0.25rem;
      padding:0.2rem 0.55rem;
      border-radius:9999px;
      border:1px solid rgba(255,255,255,0.28);
      background:rgba(15,23,42,0.35);
      font-size:0.62rem;
      letter-spacing:0.08em;
      text-transform:uppercase;
    }
    .shift-block:focus,
    .shift-block:focus-visible{ outline:2px solid rgba(255,255,255,0.55); outline-offset:4px; }
    .shift-block:hover{ transform:translateY(-4px); }
    .shift-block[data-state="past"]{ opacity:0.7; box-shadow:0 15px 40px rgba(15,23,42,0.35); }
    .shift-tooltip{
      position:absolute;
      bottom:calc(100% + 12px);
      left:50%;
      transform:translate(-50%,-4px);
      background:rgba(15,23,42,0.92);
      border:1px solid rgba(148,163,184,0.35);
      border-radius:0.75rem;
      padding:0.65rem 0.85rem;
      box-shadow:0 18px 40px rgba(8,15,30,0.55);
      display:flex;
      flex-direction:column;
      gap:0.25rem;
      min-width:190px;
      opacity:0;
      pointer-events:none;
      transition:opacity .2s ease, transform .2s ease;
      z-index:20;
    }
    .shift-tooltip::after{
      content:"";
      position:absolute;
      top:100%;
      left:50%;
      transform:translateX(-50%);
      border-width:6px;
      border-style:solid;
      border-color:rgba(15,23,42,0.92) transparent transparent transparent;
    }
    .shift-block:hover .shift-tooltip,
    .shift-block:focus .shift-tooltip,
    .shift-block:focus-visible .shift-tooltip{ opacity:1; transform:translate(-50%,-10px); pointer-events:auto; }
    .shift-tooltip-name{ font-weight:700; font-size:0.9rem; }
    .shift-tooltip-time{ font-size:0.8rem; color:rgba(226,232,240,0.85); }
    .shift-tooltip-status{ font-size:0.78rem; font-weight:600; }
    .shift-tooltip-status[data-state="current"]{ color:rgba(16,185,129,0.9); }
    .shift-tooltip-status[data-state="upcoming"]{ color:rgba(244,114,182,0.9); }
    .shift-tooltip-status[data-state="past"]{ color:rgba(148,163,184,0.85); }
    .shift-tooltip-note{ font-size:0.68rem; color:rgba(148,163,184,0.85); text-transform:uppercase; letter-spacing:0.08em; }
    .shift-timeline-hours{
      position:absolute;
      inset:0;
      display:grid;
      grid-template-columns:repeat(24,minmax(0,1fr));
      pointer-events:none;
    }
    .shift-timeline-hours span{
      position:relative;
      font-size:0.65rem;
      text-align:right;
      padding-right:4px;
      color:rgba(255,255,255,0.35);
    }
    .shift-timeline-hours span::after{
      content:"";
      position:absolute;
      right:0;
      top:0;
      bottom:0;
      width:1px;
      background:rgba(255,255,255,0.05);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:0.4rem;
      padding:0.35rem 0.7rem;
      border-radius:9999px;
      font-size:0.75rem;
      background:rgba(148,163,184,0.12);
      border:1px solid rgba(148,163,184,0.2);
    }

    .availability-pill{
      display:inline-flex;
      align-items:center;
      gap:0.5rem;
      padding:0.45rem 0.85rem;
      border-radius:9999px;
      background:rgba(59,130,246,0.18);
      border:1px solid rgba(59,130,246,0.3);
      font-size:0.85rem;
      margin:0.25rem;
    }

    .availability-pill span{
      font-weight:600;
    }

    /* Canvas particles sits behind everything */
    #particles { position:fixed; inset:0; z-index:0; pointer-events:none; }

    header.site-header{ position:fixed; top:0; left:0; right:0; z-index:50 }
    .content-wrap{ position:relative; z-index:10 }

    /* mobile nav */
    .nav-toggle{ display:inline-flex; align-items:center; justify-content:center; width:44px; height:44px }

    /* Make hero responsive */
    @media (max-width:640px){ .hero-title{ font-size:48px } }
  </style>
</head>

<body>

  <!-- Particles canvas (subtil, performant) -->
  <canvas id="particles" aria-hidden="true"></canvas>

  <!-- Header -->
  <header class="site-header glass content-wrap">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3" aria-label="Pushing P Startseite">
        <img src="assets/img/logo.png" alt="Logo" class="h-8 w-8 object-contain" onerror="this.style.display='none'">
        <h1 class="text-2xl font-black grad-text">PUSHING <span style="color:#3b82f6">P</span></h1>
      </a>

      <nav class="hidden md:flex gap-6 items-center" role="navigation" aria-label="Hauptnavigation">
        <a href="#crew" class="hover:text-blue-400 transition-colors">Crew</a>
        <a href="#shiftradar" class="hover:text-blue-400 transition-colors">Schichten</a>
        <a href="#modules" class="hover:text-blue-400 transition-colors">Features</a>
        <a href="#login" class="hover:text-blue-400 transition-colors">Login</a>
        <a href="login.php" class="magnet bg-white/10 px-3 py-1 rounded-xl hover:bg-white/20">Anmelden</a>
      </nav>

      <!-- Mobile toggle -->
      <button id="mobileToggle" class="md:hidden nav-toggle glass-strong" aria-expanded="false" aria-controls="mobileMenu" aria-label="Men√º √∂ffnen">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path stroke="#fff" stroke-width="1.8" stroke-linecap="round" d="M3 6h18M3 12h18M3 18h18"></path></svg>
      </button>
    </div>

    <div id="mobileMenu" class="md:hidden max-w-7xl mx-auto px-4 pb-4 hidden" role="menu">
      <div class="flex flex-col gap-3">
        <a href="#crew" class="block py-2">Crew</a>
        <a href="#shiftradar" class="block py-2">Schichten</a>
        <a href="#modules" class="block py-2">Features</a>
        <a href="#login" class="block py-2">Login</a>
        <a href="login.php" class="block py-2">Anmelden</a>
      </div>
    </div>
  </header>

  <main class="content-wrap">
    <!-- Hero -->
    <section class="pt-28 pb-20 text-center relative overflow-hidden">
      <div class="hero-neon" aria-hidden="true"></div>
      <div class="hero-wires" aria-hidden="true"></div>
      <div class="hero-spark" aria-hidden="true"></div>
      <div class="aurora-line" aria-hidden="true"></div>
      <div class="max-w-4xl mx-auto px-4">
        <h2 class="hero-title text-6xl md:text-7xl lg:text-8xl font-extrabold grad-text mb-4">PUSHING <span class="inline-block float" style="color:#3b82f6">P</span></h2>
        <p class="text-lg text-white/80 mb-6">Eine Crew. Ein Vibe. Kasse, Schichten, Live-Status ‚Äî alles an einem Ort.</p>

        <div class="flex gap-4 justify-center items-center mb-8 flex-wrap hero-actions">
          <a href="#modules" class="magnet bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-3 rounded-2xl font-bold text-lg shadow-glow pulse-glow">Los geht's üöÄ</a>
          <a href="#crew" class="magnet glass-strong px-6 py-3 rounded-2xl font-bold text-lg">Crew ansehen üë•</a>
        </div>

        <div class="flex gap-4 justify-center text-sm text-white/60 hero-metrics">
          <div class="glass-strong rounded-xl px-4 py-2">Live Kassenstand: <strong id="balance">L√§dt...</strong></div>
          <div class="glass-strong rounded-xl px-4 py-2">Schichten heute: <strong id="shiftsCount">‚Äì</strong></div>
          <div class="glass-strong rounded-xl px-4 py-2">Online jetzt: <strong id="online">Wird geladen...</strong></div>
        </div>
      </div>
    </section>

    <!-- Shift Radar -->
    <section id="shiftradar" class="py-20 max-w-7xl mx-auto px-6">
      <div class="text-center mb-14 space-y-4">
        <div class="flex justify-center">
          <span class="badge">Schichtsystem 2.0</span>
        </div>
        <h3 class="text-4xl sm:text-5xl font-extrabold grad-text">Schicht Radar</h3>
        <p class="text-white/60 max-w-3xl mx-auto">Behalte die ganzen 25 Stunden im Blick: Wer ist gerade auf Schicht, wer √ºbernimmt als N√§chstes und wer steht der Crew spontan zur Verf√ºgung.</p>
      </div>

      <div class="shift-grid">
        <div class="glass-strong rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-xl font-bold">Jetzt auf Schicht</h4>
            <span class="badge"><span class="h-2 w-2 rounded-full bg-emerald-400 inline-block animate-pulse"></span> Live</span>
          </div>
          <ul id="currentShiftList" class="space-y-3 text-sm text-white/80"></ul>
          <p id="currentShiftEmpty" class="text-white/40 text-sm hidden">Aktuell keine Schicht ‚Äì die Crew hat Luft.</p>
        </div>

        <div class="glass-strong rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-xl font-bold">Als n√§chstes dran</h4>
            <span class="badge">Plan</span>
          </div>
          <ul id="nextShiftList" class="space-y-3 text-sm text-white/80"></ul>
          <p id="nextShiftEmpty" class="text-white/40 text-sm hidden">Heute steht keine weitere Schicht an.</p>
        </div>

        <div class="glass-strong rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-xl font-bold">Verf√ºgbarkeit</h4>
            <span class="badge">Status</span>
          </div>
          <div>
            <p class="text-xs uppercase tracking-wide text-white/40 mb-2">Jetzt frei</p>
            <div id="availableNowList" class="flex flex-wrap"></div>
            <p id="availableNowEmpty" class="text-white/40 text-sm hidden">Alle sind gerade eingespannt.</p>
          </div>
          <div class="mt-6 pt-6 border-t border-white/10">
            <p class="text-xs uppercase tracking-wide text-white/40 mb-2">Danach verf√ºgbar</p>
            <div id="availableLaterList" class="flex flex-wrap"></div>
            <p id="availableLaterEmpty" class="text-white/40 text-sm hidden">Alle Schichten verteilt.</p>
          </div>
        </div>
      </div>

      <div class="mt-12 shift-timeline">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <h4 class="text-2xl font-bold">Der ganze Tag auf einen Blick</h4>
            <p class="text-white/50 text-sm">Visualisiert 25 Stunden ‚Äì von 00:00 bis 24:59.</p>
          </div>
          <div class="badge">Heute <span id="shiftDayLabel" class="font-semibold"></span></div>
        </div>
        <div class="mt-6 shift-timeline-track">
          <div class="shift-timeline-hours" id="shiftTimelineHours"></div>
          <div id="shiftTimelineTrack"></div>
        </div>
        <div class="mt-6 grid md:grid-cols-2 gap-4" id="shiftScheduleList"></div>
      </div>
    </section>

    <!-- Crew -->
    <section id="crew" class="py-16 max-w-7xl mx-auto px-6">
      <div class="text-center mb-12">
        <h3 class="text-4xl sm:text-5xl font-extrabold mb-2 grad-text">Die Crew</h3>
        <p class="text-white/60">Unser Team im √úberblick</p>
      </div>
      <div id="crewList" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
    </section>

    <!-- Modules -->
    <section id="modules" class="py-16 max-w-7xl mx-auto px-6">
      <div class="text-center mb-12">
        <h3 class="text-4xl sm:text-5xl font-extrabold mb-2 grad-text">Features</h3>
        <p class="text-white/60">Alles was du brauchst, an einem Ort</p>
      </div>

      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <a href="login.php" class="stat-card glass-strong rounded-2xl p-6 hover:shadow-glow block cursor-pointer">
          <div class="text-4xl mb-2">üí∞</div>
          <h4 class="text-xl font-bold mb-1">Kasse</h4>
          <p id="balanceSmall" class="text-2xl font-black text-blue-400">L√§dt...</p>
          <p class="text-white/60 text-sm mt-2">Live Kassenstand ‚Äî immer up-to-date</p>
        </a>

        <a href="login.php" class="stat-card glass-strong rounded-2xl p-6 hover:shadow-glow block cursor-pointer">
          <div class="text-4xl mb-2">üïì</div>
          <h4 class="text-xl font-bold mb-1">Schichten</h4>
          <p id="shiftsCountSmall" class="text-2xl font-black text-purple-400">‚Äì</p>
          <p class="text-white/60 text-sm mt-2">Schichten heute ‚Äî schnell einsehen</p>
        </a>

        <a href="login.php" class="stat-card glass-strong rounded-2xl p-6 hover:shadow-glow block cursor-pointer">
          <div class="text-4xl mb-2">üü¢</div>
          <h4 class="text-xl font-bold mb-1">Live Status</h4>
          <p id="onlineSmall" class="text-2xl font-black text-emerald-400">Wird geladen...</p>
          <p class="text-white/60 text-sm mt-2">Wer ist gerade online</p>
        </a>
      </div>
    </section>

    <!-- Login (compact) -->
    <section id="login" class="py-16 max-w-7xl mx-auto px-6">
      <div class="text-center mb-8">
        <h3 class="text-3xl sm:text-4xl font-extrabold mb-2 grad-text">Anmelden</h3>
        <p class="text-white/60">Melde dich an, um auf dein Dashboard zuzugreifen</p>
      </div>
      <div class="max-w-md mx-auto">
        <div class="glass-strong rounded-2xl p-6">
          <form id="loginForm" class="space-y-4" aria-label="Login-Formular">
            <div>
              <label for="name" class="block text-sm text-white/70 mb-2">Name</label>
              <input id="name" name="name" type="text" placeholder="Dein Name" class="w-full p-3 rounded-xl text-black outline-none" list="names" required autocomplete="off">
              <datalist id="names"></datalist>
            </div>
            <div>
              <label class="block text-sm text-white/70 mb-2">PIN</label>
              <input name="pin" type="password" placeholder="PIN (4‚Äì6 Ziffern)" class="w-full p-3 rounded-xl text-black outline-none" required>
            </div>
            <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 px-4 py-3 rounded-xl font-bold text-lg">Einloggen üöÄ</button>
            <p id="msg" class="text-red-400 text-sm text-center min-h-[24px]"></p>
          </form>
        </div>
      </div>
    </section>
  </main>

  <script>
  // --- Utilities & enhancements ---
  gsap.registerPlugin(ScrollTrigger);

  const state = { members: [], shifts: [] };

  // Mobile nav toggle
  const mobileToggle = document.getElementById('mobileToggle');
  const mobileMenu = document.getElementById('mobileMenu');
  mobileToggle.addEventListener('click', () => {
    const open = mobileMenu.classList.toggle('hidden') === false;
    mobileToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
  });

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      const href = this.getAttribute('href');
      if (href && href.startsWith('#')) {
        e.preventDefault();
        const target = document.querySelector(href);
        if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });

  // --- Data loading (reuse existing endpoints) ---
  async function loadCrew(){
    try{
      const res = await fetch('api/get_members.php');
      if(!res.ok) throw new Error('Crew load failed');
      const members = await res.json();
      state.members = Array.isArray(members) ? members : [];
      const list = document.getElementById('crewList');
      const datalist = document.getElementById('names');
      list.innerHTML = '';
      datalist.innerHTML = '';
      (state.members||[]).forEach((m,i)=>{
        const el = document.createElement('div');
        el.className = 'stat-card glass-strong p-6 rounded-2xl';
        el.innerHTML = `<div class="flex items-center gap-4"><div class="h-16 w-16 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-2xl font-black">${(m.name||'?')[0].toUpperCase()}</div><div class="flex-1"><h4 class="font-bold text-lg mb-1">${m.name}</h4><p class="text-white/60">${m.flag||'üåç'}</p></div></div>`;
        list.appendChild(el);
        gsap.from(el,{duration:0.6,y:30,opacity:0,delay:i*0.05,ease:'power3.out'});
        const opt = document.createElement('option'); opt.value = m.name; datalist.appendChild(opt);
      });
      if(!state.members || state.members.length===0) list.innerHTML = '<div class="col-span-full text-center py-12 text-white/50">Keine Mitglieder gefunden</div>';
      renderShiftBoard();
    }catch(e){ console.error(e); document.getElementById('crewList').innerHTML = '<div class="col-span-full text-center py-12 text-red-400">Fehler beim Laden der Crew</div>' }
  }

  async function loadBalance(){ try{ const res = await fetch('api/get_balance.php'); const data = await res.json(); const total = (data||[]).reduce((s,i)=>s+parseFloat(i.balance||0),0); document.getElementById('balance').textContent = total.toFixed(2)+ ' ‚Ç¨'; document.getElementById('balanceSmall').textContent = total.toFixed(2)+' ‚Ç¨'; }catch(e){ document.getElementById('balance').textContent='Fehler'; document.getElementById('balanceSmall').textContent='Fehler' } }

  async function loadOnline(){ try{ const res = await fetch('api/discord_status.php'); const data = await res.json(); const cnt = data.count||0; document.getElementById('online').textContent = cnt + ' online'; document.getElementById('onlineSmall').textContent = cnt + ' online'; }catch(e){ document.getElementById('online').textContent='Fehler'; document.getElementById('onlineSmall').textContent='Fehler' } }

  async function loadShifts(){
    try{
      const res = await fetch('api/get_shifts.php');
      if(!res.ok) throw new Error('Shift load failed');
      const data = await res.json();
      state.shifts = Array.isArray(data) ? data : [];
      updateShiftCounts();
      renderShiftBoard();
    }catch(e){
      console.error(e);
      document.getElementById('shiftsCount').textContent='?';
      document.getElementById('shiftsCountSmall').textContent='?';
    }
  }

  function getTodayIso(){
    const now = new Date();
    const local = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    return local.toISOString().split('T')[0];
  }

  function updateShiftCounts(){
    const today = getTodayIso();
    const todayShifts = (state.shifts||[]).filter(s=>s.shift_date===today);
    const count = todayShifts.length;
    document.getElementById('shiftsCount').textContent = count;
    document.getElementById('shiftsCountSmall').textContent = count;
  }

  function renderShiftBoard(){
    const currentList = document.getElementById('currentShiftList');
    if(!currentList) return;

    const nextList = document.getElementById('nextShiftList');
    const availableNowList = document.getElementById('availableNowList');
    const availableLaterList = document.getElementById('availableLaterList');
    const scheduleList = document.getElementById('shiftScheduleList');
    const timelineTrack = document.getElementById('shiftTimelineTrack');
    const timelineHours = document.getElementById('shiftTimelineHours');
    const dayLabel = document.getElementById('shiftDayLabel');

    const todayIso = getTodayIso();
    const dayStart = new Date(`${todayIso}T00:00:00`);
    const dayEnd = new Date(dayStart.getTime() + 24*60*60*1000);
    const now = new Date();

    const dayFormatter = new Intl.DateTimeFormat('de-DE', { weekday:'long', day:'2-digit', month:'2-digit' });
    const shortDayFormatter = new Intl.DateTimeFormat('de-DE', { weekday:'short', day:'2-digit', month:'2-digit' });
    const timeFormatter = new Intl.DateTimeFormat('de-DE', { hour: '2-digit', minute: '2-digit' });

    dayLabel.textContent = dayFormatter.format(dayStart);

    const processedShifts = (state.shifts||[])
      .map(s => {
        const start = new Date(`${s.shift_date}T${s.shift_start}`);
        let end = new Date(`${s.shift_date}T${s.shift_end}`);
        if(Number.isNaN(start.getTime())) return null;
        if(Number.isNaN(end.getTime())){ end = new Date(start.getTime() + 60 * 60 * 1000); }
        if(end <= start){ end = new Date(end.getTime() + 24 * 60 * 60 * 1000); }
        const continuesNextDay = end > dayEnd;
        const displayStart = (start >= dayStart && start < dayEnd)
          ? timeFormatter.format(start)
          : `${shortDayFormatter.format(start)} ${timeFormatter.format(start)}`;
        const displayEnd = end <= dayEnd
          ? timeFormatter.format(end)
          : `${shortDayFormatter.format(end)} ${timeFormatter.format(end)}`;
        return {
          ...s,
          start,
          end,
          continuesNextDay,
          display:`${displayStart} ‚Äì ${displayEnd}`
        };
      })
      .filter(Boolean);

    const dayShifts = processedShifts
      .filter(shift => shift.end > dayStart && shift.start < dayEnd)
      .map(shift => ({
        ...shift,
        cappedEnd: shift.end > dayEnd ? dayEnd : shift.end
      }))
      .sort((a,b)=>a.start-b.start);

    const current = dayShifts.filter(shift => now >= shift.start && now < shift.end);
    const upcoming = dayShifts.filter(shift => shift.start > now);

    // Current shifts list
    currentList.innerHTML = '';
    document.getElementById('currentShiftEmpty').classList.toggle('hidden', current.length !== 0);
    current.forEach(shift => {
      const li = document.createElement('li');
      li.innerHTML = `<div class="flex items-center justify-between"><span class="font-semibold text-white">${shift.member_name}</span><span class="text-white/50">${shift.display}</span></div>`;
      currentList.appendChild(li);
    });

    // Next shifts
    nextList.innerHTML = '';
    document.getElementById('nextShiftEmpty').classList.toggle('hidden', upcoming.length !== 0);
    upcoming.slice(0,3).forEach(shift => {
      const li = document.createElement('li');
      li.innerHTML = `<div class="flex items-center justify-between"><span class="font-semibold text-white">${shift.member_name}</span><span class="text-white/50">${shift.display}</span></div>`;
      nextList.appendChild(li);
    });

    // Availability
    availableNowList.innerHTML = '';
    const currentNames = new Set(current.map(s=>s.member_name));
    const availableNow = (state.members||[]).filter(m => !currentNames.has(m.name));
    document.getElementById('availableNowEmpty').classList.toggle('hidden', availableNow.length !== 0);
    availableNow.forEach(member => {
      const pill = document.createElement('span');
      pill.className = 'availability-pill';
      pill.innerHTML = `<span>${member.flag || 'üåç'}</span>${member.name}`;
      availableNowList.appendChild(pill);
    });

    const upcomingNames = new Set(upcoming.map(s=>s.member_name));
    availableLaterList.innerHTML = '';
    document.getElementById('availableLaterEmpty').classList.toggle('hidden', upcomingNames.size !== 0);
    Array.from(upcomingNames).slice(0,6).forEach(name => {
      const pill = document.createElement('span');
      pill.className = 'availability-pill';
      pill.style.background = 'rgba(244,114,182,0.18)';
      pill.style.borderColor = 'rgba(244,114,182,0.3)';
      pill.textContent = name;
      availableLaterList.appendChild(pill);
    });

    // Timeline hours
    timelineHours.innerHTML = '';
    for(let h=0; h<24; h++){
      const span = document.createElement('span');
      if(h % 3 === 0) span.textContent = `${String(h).padStart(2,'0')}h`;
      timelineHours.appendChild(span);
    }

    // Timeline blocks
    timelineTrack.innerHTML = '';
    const minutesInDay = 24 * 60;
    const statusLabels = {
      current:'Aktive Schicht',
      upcoming:'Geplante Schicht',
      past:'Abgeschlossene Schicht'
    };

    dayShifts.forEach((shift, index) => {
      const visibleStart = shift.start < dayStart ? dayStart : shift.start;
      const visibleEnd = shift.cappedEnd;
      const startMinutes = Math.max(0, Math.floor((visibleStart - dayStart)/60000));
      const endMinutes = Math.min(minutesInDay, Math.ceil((visibleEnd - dayStart)/60000));
      const duration = Math.max(30, endMinutes - startMinutes);
      const block = document.createElement('div');
      block.className = 'shift-block';
      const stateAttr = now >= shift.start && now < shift.end ? 'current' : (shift.start > now ? 'upcoming' : 'past');
      block.dataset.state = stateAttr;
      if(shift.continuesNextDay) block.dataset.extends = 'true';
      block.style.left = `${(startMinutes / minutesInDay) * 100}%`;
      block.style.width = `${Math.max((duration / minutesInDay) * 100, 4)}%`;
      block.tabIndex = 0;
      block.setAttribute('aria-label', `${shift.member_name}: ${shift.display}`);

      const nameEl = document.createElement('strong');
      nameEl.className = 'text-sm';
      nameEl.textContent = shift.member_name;
      const timeEl = document.createElement('span');
      timeEl.className = 'shift-time';
      timeEl.textContent = shift.display;
      block.appendChild(nameEl);
      block.appendChild(timeEl);

      if(shift.continuesNextDay){
        const badge = document.createElement('span');
        badge.className = 'shift-overnight';
        badge.textContent = 'Folgetag';
        block.appendChild(badge);
      }

      const tooltip = document.createElement('div');
      tooltip.className = 'shift-tooltip';
      const tooltipSlug = shift.id ? String(shift.id).replace(/[^a-zA-Z0-9_-]/g,'') : `idx-${index}`;
      const tooltipId = `shift-tip-${tooltipSlug}`;
      tooltip.id = tooltipId;
      block.setAttribute('aria-describedby', tooltipId);

      const tooltipName = document.createElement('div');
      tooltipName.className = 'shift-tooltip-name';
      tooltipName.textContent = shift.member_name;
      tooltip.appendChild(tooltipName);

      const tooltipTime = document.createElement('div');
      tooltipTime.className = 'shift-tooltip-time';
      tooltipTime.textContent = shift.display;
      tooltip.appendChild(tooltipTime);

      const tooltipStatus = document.createElement('div');
      tooltipStatus.className = 'shift-tooltip-status';
      tooltipStatus.dataset.state = stateAttr;
      tooltipStatus.textContent = statusLabels[stateAttr];
      tooltip.appendChild(tooltipStatus);

      if(shift.continuesNextDay){
        const tooltipNote = document.createElement('div');
        tooltipNote.className = 'shift-tooltip-note';
        tooltipNote.textContent = `Endet am Folgetag um ${timeFormatter.format(shift.end)}`;
        tooltip.appendChild(tooltipNote);
      }

      block.appendChild(tooltip);
      timelineTrack.appendChild(block);
    });

    // Schedule list
    scheduleList.innerHTML = '';
    if(dayShifts.length === 0){
      scheduleList.innerHTML = '<div class="text-white/40 text-sm">Heute wurden keine Schichten geplant.</div>';
    }else{
      dayShifts.forEach(shift => {
        const ref = shift.id ? `#${shift.id}` : 'Plan';
        const card = document.createElement('div');
        card.className = 'glass-strong rounded-2xl p-4 flex items-center justify-between';
        card.innerHTML = `<div><div class="text-sm text-white/60">${shift.display}</div><div class="text-lg font-semibold">${shift.member_name}</div></div><div class="text-xs text-white/40 uppercase tracking-wide">${ref}</div>`;
        scheduleList.appendChild(card);
      });
    }
  }

  // Login handler (same endpoints)
  document.getElementById('loginForm').addEventListener('submit', async e => {
    e.preventDefault();
    const formData = new FormData(e.target);
    try{
      const res = await fetch('api/login.php',{method:'POST',body:formData});
      const data = await res.json();
      if(data.status==='ok'){ window.location.href = data.admin ? 'admin/' : 'member.php'; }
      else document.getElementById('msg').textContent = data.error || 'Login fehlgeschlagen';
    }catch(err){ document.getElementById('msg').textContent = 'Netzwerkfehler'; }
  });

  // GSAP entrance animations
  gsap.utils.toArray('.stat-card, .hero-title, .glass-strong, .grad-text').forEach((el,i)=>{
    gsap.from(el,{ scrollTrigger:{ trigger:el, start:'top 90%', toggleActions:'play none none none', once:true }, duration:0.8, y:40, opacity:0, delay:i*0.06, ease:'power3.out' });
  });

  gsap.timeline({ defaults:{ ease:'power3.out' } })
    .from('.hero-title', { y:80, opacity:0, duration:1 })
    .from('.hero-actions', { y:40, opacity:0, duration:0.8 }, '-=0.55')
    .from('.hero-metrics > div', { y:30, opacity:0, duration:0.6, stagger:0.12 }, '-=0.4');

  gsap.to('.hero-neon', { rotate:3, duration:18, repeat:-1, yoyo:true, ease:'sine.inOut' });
  gsap.to('.hero-spark', { scale:1.05, duration:8, repeat:-1, yoyo:true, ease:'sine.inOut' });

  // --- Subtle particle background ---
  (function particleBg(){
    const canvas = document.getElementById('particles');
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    let w = canvas.width = innerWidth; let h = canvas.height = innerHeight; const DPR = Math.max(1, window.devicePixelRatio || 1);
    canvas.width = w * DPR; canvas.height = h * DPR; canvas.style.width = w + 'px'; canvas.style.height = h + 'px'; ctx.scale(DPR, DPR);
    const particles = [];
    const count = Math.round((w*h)/90000); // adaptive
    for(let i=0;i<count;i++){ particles.push({ x:Math.random()*w, y:Math.random()*h, vx:(Math.random()-0.5)*0.3, vy:(Math.random()-0.5)*0.3, r:1+Math.random()*2 }) }
    function tick(){ ctx.clearRect(0,0,w,h); for(let p of particles){ p.x+=p.vx; p.y+=p.vy; if(p.x<0)p.x=w; if(p.x>w)p.x=0; if(p.y<0)p.y=h; if(p.y>h)p.y=0; ctx.beginPath(); ctx.fillStyle='rgba(255,255,255,0.06)'; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); }
      // connect
      for(let i=0;i<particles.length;i++){ for(let j=i+1;j<particles.length;j++){ const a=particles[i], b=particles[j]; const dx=a.x-b.x, dy=a.y-b.y; const d=dx*dx+dy*dy; if(d<9000){ const alpha = 0.03*(1 - d/9000); ctx.strokeStyle='rgba(140,160,255,'+alpha+')'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); } } }
      requestAnimationFrame(tick);
    }
    tick();
    addEventListener('resize',()=>{ w=canvas.width=innerWidth; h=canvas.height=innerHeight; canvas.width = w*DPR; canvas.height = h*DPR; canvas.style.width = w+'px'; canvas.style.height = h+'px'; ctx.scale(DPR,DPR); });
  })();

  // Init data
  async function initLanding(){
    await Promise.allSettled([
      loadCrew(),
      loadBalance(),
      loadOnline(),
      loadShifts()
    ]);
  }

  initLanding();
  </script>

</body>
</html>
